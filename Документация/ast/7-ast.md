# Оптимизация операции сравнения равно !heading

### Команда Intel

#### Постановка задачи

Требуется найти в AST-дереве операторы сравнения, оба операнда которого являются числами на этапе компиляции и заменить их на логическое утверждение этих операторов.


#### Зависимости задач в графе задач

Данная задача не зависит от других задач в графе задач и не порождает новых зависимостей.


#### Теория

В исходном коде программы зачастую появляются случаи, когда уже на этапе компиляции ясно, какие значения приняли те или иные переменные, являющейся операндами в оператора сравнения. Преждевременная замена таких операторов на логические выражения, соответствующие смыслу этих операторов может заметно ускорить программу на этапе выполнения.


#### Особенности реализации

```
public override void VisitLogicOpNode (LogicOpNode lop) 
        {
            if (lop.Left is ExprNode)
                lop.Left.Visit(this); 

            if (lop.Right is ExprNode)
                lop.Right.Visit(this);

            if (lop.Left is IntNumNode l && lop.Right is IntNumNode r && (lop.Operation == "==")) {
                bool nbool = l.Num == r.Num;
                if (lop.Parent is IfNode ifn) {
                    ifn.Cond = new BooleanNode(nbool);
                    SetApply();
                } else
                    if (lop.Parent is WhileNode w) {
                    w.Expr = new BooleanNode(nbool);
                    SetApply();
                    } else
                        ReplaceExpr(lop, new BooleanNode(nbool));
            } else {
                base.VisitLogicOpNode(lop);
            }
        }

```

Была переопределена функция VisitLogicOpNode. Стоит отметить, что перед заменой оператора сравнения на его логическое значение необходимо заранее обойти каждого из операндов для рекурсивной проверки их на возможность такой-же оптимизации. Оптимизации происходит только в случае принадлежности обоих операндов численному типу.



#### Тесты

Программа до применения оптимизации:
```
{
	bool w;
	w = (1 == 2) && (4 == 4);
}
```

Программа после применения оптимизации:
```
{
    var w;
    w = (false && true);
}
```

[Вверх](#содержание)